{"version":3,"sources":["templates/module/index.js"],"names":[],"mappings":"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","file":"templates/module/index.js","sourcesContent":["const fs = require('fs');\nimport path from 'path';\nimport walk from 'walk';\nimport mkdirp from 'mkdirp';\n\nconst sourcePath = path.join(__dirname, 'src');\n\nasync function writeAsync(directory, filename, contents) {\n  return new Promise((resolve, reject) => {\n    mkdirp(directory, async (err) => {\n      if (err) return reject(err);\n      let filePath = path.join(directory, filename);\n      await fs.promise.writeFile(filePath, contents, 'utf8');\n      resolve();\n    });\n  });\n}\n\nfunction fixPath(config, path) {\n  let keys = Object.keys(config);\n  keys.forEach((key) => {\n    path = path.replace(`__${key}__`, config[key]);\n  });\n  return path;\n}\n\nfunction walkerErrorHandler(root, nodeStatsArray, next) {\n  nodeStatsArray.forEach(n => {\n    console.error(`[ERROR] ${n.name}`);\n    console.error(n.error.message || (n.error.code + \": \" + n.error.path));\n  });\n  next();\n}\n\nfunction createWalkerFileHandler(config, directory) {\n  let pathConfig = {\n    moduleName: config.moduleName,\n    moduleNameAndroid: config.android.moduleName,\n    moduleNameIOS: config.ios.moduleName\n  };\n  \n  return async (root, stat, next) => {\n    let originalPath = path.join(root, stat.name);\n    delete require.cache[originalPath];\n    let template = require(originalPath);\n    let relativePath = root.replace(sourcePath, '.');\n    let finalPath = path.join(directory, relativePath);\n\n    // Ensure Android's Java files are added into a folder structure matching the package identifier\n    if (relativePath === './android/src/main/java') {\n      finalPath = path.join(finalPath, config.android.packageIdentifier.replace(new RegExp('\\\\.', 'g'), '/'));\n    }\n    \n    let fixedPath = fixPath(pathConfig, finalPath);\n    let fixedFilename = fixPath(pathConfig, stat.name);\n    \n    let lastDotIndex = fixedFilename.lastIndexOf('.');\n    let extension = fixedFilename.slice(lastDotIndex);\n    if (extension === '.js') {\n      fixedFilename = fixedFilename.slice(0, lastDotIndex);\n    }\n  \n    await writeAsync(fixedPath, fixedFilename, template(config));\n    next(); \n  }\n}\n\nexport async function build(config, directory) {\n  \n  let walkerFileHandler = createWalkerFileHandler(config, directory);\n  \n  return new Promise((resolve, reject) => {\n    let walker = walk.walk(sourcePath);\n    walker.on('file', walkerFileHandler);\n    walker.on('errors', walkerErrorHandler);\n    walker.on('end', resolve);\n  });\n}"],"sourceRoot":"/source/"}